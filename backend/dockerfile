# Базовый образ: Python 3.12 slim
FROM python:3.12-slim

# Рабочая директория
WORKDIR /app

# Копируем зависимости
COPY pyproject.toml poetry.lock ./
RUN pip install poetry && poetry config virtualenvs.create false && poetry install --only=main --no-root

# Копируем код
COPY . .

# Порты и env
EXPOSE 5000
ENV PYTHONUNBUFFERED=1

# Multi-stage: Web (gunicorn) и workers (Celery)
CMD ["gunicorn", "--bind", "0.0.0.0:5000", "app:app"]